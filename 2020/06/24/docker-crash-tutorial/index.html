<!DOCTYPE HTML>
<html lang="zh-CN">


<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <meta name="keywords" content="Docker-Crash-Tutorial, Bosch SEU chaoqiang Mechanics Eletronics 超强 micro-service Intelligent-Manufacturing MES">
    <meta name="description" content="主要内容
Docker  VS  VirtualMachine
centOS7下Docker基本操作
Asp.Net Core+Docker
Docker部署集群负载均衡
Docker-compose docker-machine dock">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Docker-Crash-Tutorial | chaoqiang&#39;s Blog</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">
    
    <script src="/libs/jquery/jquery.min.js"></script>
    
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper head-container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <span class="logo-span">chaoqiang's Blog</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/AV" class="waves-effect waves-light">

      
      <i class="fas fa-list" style="zoom: 0.6;"></i>
      
      <span>Medias</span>
      <i class="fas fa-chevron-down" aria-hidden="true" style="zoom: 0.6;"></i>
    </a>
    <ul class="sub-nav menus_item_child ">
      
      <li>
        <a href="/Music">
          
          <i class="fas fa-music" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>Musics</span>
        </a>
      </li>
      
      <li>
        <a href="/Movie">
          
          <i class="fas fa-film" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>Movies</span>
        </a>
      </li>
      
      <li>
        <a href="/Book">
          
          <i class="fas fa-book" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>Books</span>
        </a>
      </li>
      
      <li>
        <a href="/AV">
          
          <i class="fas fa-image" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>Galleries</span>
        </a>
      </li>
      
    </ul>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>

<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <div class="logo-name">chaoqiang's Blog</div>
        <div class="logo-desc">
            
            博世互联工业 | 智能制造 | 微服务架构 | 东南大学 | 机械电子工程
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="javascript:;">
			
				<i class="fa-fw fas fa-list"></i>
			
			Medias
			<span class="m-icon"><i class="fas fa-chevron-right"></i></span>
		</a>
            <ul  style="background:  ;" >
              
                <li>   
				
                  <a href="/Music " style="margin-left:75px";>
				  
				   <i class="fa fas fa-music" style="position: absolute;left:50px" ></i>
			      
		          <span>Musics</span>
                  </a>
                </li>
              
                <li>   
				
                  <a href="/Movie " style="margin-left:75px";>
				  
				   <i class="fa fas fa-film" style="position: absolute;left:50px" ></i>
			      
		          <span>Movies</span>
                  </a>
                </li>
              
                <li>   
				
                  <a href="/Book " style="margin-left:75px";>
				  
				   <i class="fa fas fa-book" style="position: absolute;left:50px" ></i>
			      
		          <span>Books</span>
                  </a>
                </li>
              
                <li>   
				
                  <a href="/AV " style="margin-left:75px";>
				  
				   <i class="fa fas fa-image" style="position: absolute;left:50px" ></i>
			      
		          <span>Galleries</span>
                  </a>
                </li>
               
            </ul>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/Zhengchaoqiang" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>

        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/Zhengchaoqiang" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    
<script src="/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('请输入访问本文章的密码')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/1.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">Docker-Crash-Tutorial</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        height: calc(100vh - 250px);
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #toc-content .is-active-link::before {
        background-color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/Docker/">
                                <span class="chip bg-color">Docker</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/Docker-Crash-Tutorial/" class="post-category">
                                Docker Crash Tutorial
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2020-06-24
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2020-06-26
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    5.2k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    20 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>

        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <h2 id="主要内容"><a href="#主要内容" class="headerlink" title="主要内容"></a>主要内容</h2><ol>
<li>Docker  VS  VirtualMachine</li>
<li>centOS7下Docker基本操作</li>
<li>Asp.Net Core+Docker</li>
<li>Docker部署集群负载均衡</li>
<li>Docker-compose docker-machine docker-swarm</li>
</ol>
<h3 id="虚拟机–容器来源"><a href="#虚拟机–容器来源" class="headerlink" title="虚拟机–容器来源"></a>虚拟机–容器来源</h3><ul>
<li>硬件发展速度—各种翻倍—服务器内存—Asp.Net+SqlServer+Nginx—资源利用率太低—能不能分开用</li>
<li>环境冲突，程序之间相互影响</li>
<li>快速部署的需求—发布集群的时候</li>
</ul>
<p><strong>目的</strong>: 把一个大的服务器分解成多个小的个体，五脏俱全，各种应用分布在不同的个体里面，互不影响—利用率提高—镜像快速部署。<br>2011—云计算时代</p>
<h3 id="VM-云计算"><a href="#VM-云计算" class="headerlink" title="VM-云计算"></a>VM-云计算</h3><ul>
<li>Vitual Machine—独立的完整服务器—ecs—模拟了操作系统+安装完整的环境依赖+应用程序</li>
<li>Hypervisor1 和 Hypervisor2 都需要一波虚拟机管理系统</li>
<li>Hypervisor1 直接架构在硬件上实现</li>
<li>Hypervisor2 操作系统上利用虚拟机管理技术实现</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://netimprovingseries-1257411902.cos.ap-shanghai.myqcloud.com/Docker/Hypervisor.png" alt=""></p>
<h3 id="番外篇-云计算"><a href="#番外篇-云计算" class="headerlink" title="番外篇-云计算"></a>番外篇-云计算</h3><p><strong>何谓云计算？</strong></p>
<ul>
<li>云计算就是大型服务器分多个虚拟机</li>
<li>然后能控制计算资源，对外出售服务，卖的就是计算资源</li>
<li>按需付费—-现在云计算是资源+服务</li>
<li>也可以把小型机联合管理，提供大的计算能力</li>
</ul>
<h3 id="容器技术"><a href="#容器技术" class="headerlink" title="容器技术"></a>容器技术</h3><p>Docker就是虚拟化的一种轻量级替代技术。Docker的容器技术不依赖任何语言、框架或系统，可以将App变成一种 标准化的、可移植的、自管理的组件，并脱离服务器硬件在任何主流系统中开发、调试和运行。</p>
<p>容器是隔离的小个体—轻量级—共享内核。<br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://netimprovingseries-1257411902.cos.ap-shanghai.myqcloud.com/Docker/Container.png" alt=""></p>
<h3 id="Docker基础架构"><a href="#Docker基础架构" class="headerlink" title="Docker基础架构"></a>Docker基础架构</h3><ol>
<li>namespace命名空间: Linux特有的，用来隔离进程，管控资源权限;</li>
<li>Control group控制组: 控制进程使用资源的大小，能用多少资源</li>
<li>LXC(Linux containers): Namespace+cgroup 容器技术—共享内核 SDK</li>
<li>Docker—是在Lxc做了封装，做了开发，提供业务功能</li>
</ol>
<h2 id="Docker是啥？"><a href="#Docker是啥？" class="headerlink" title="Docker是啥？"></a>Docker是啥？</h2><p>说人话！容器到底是啥？鲸鱼是docker 引擎，守护进程；水是操作系统，深入内核；集装箱是容器，container, 每个集装箱里面是一个完整的东西。</p>
<ul>
<li>Docker是一种虚拟化的解决方案</li>
<li>可以让应用+依赖独立起来—高效</li>
<li>而且能快速复制</li>
<li>Docker其实是一项应用，Client/Server</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://netimprovingseries-1257411902.cos.ap-shanghai.myqcloud.com/Docker/docker.jpg" alt=""></p>
<h3 id="对比-物理机-虚拟机-Docker"><a href="#对比-物理机-虚拟机-Docker" class="headerlink" title="对比 物理机-虚拟机-Docker"></a>对比 物理机-虚拟机-Docker</h3><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://netimprovingseries-1257411902.cos.ap-shanghai.myqcloud.com/Docker/Physicalmachine.jpg" alt=""><br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://netimprovingseries-1257411902.cos.ap-shanghai.myqcloud.com/Docker/Suite.jpg" alt=""><br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://netimprovingseries-1257411902.cos.ap-shanghai.myqcloud.com/Docker/DockerContainer.jpg" alt=""></p>
<h2 id="Docker命令"><a href="#Docker命令" class="headerlink" title="Docker命令"></a>Docker命令</h2><h3 id="基于Centos操作系统的Docker环境安装"><a href="#基于Centos操作系统的Docker环境安装" class="headerlink" title="基于Centos操作系统的Docker环境安装"></a>基于Centos操作系统的Docker环境安装</h3><p>参考docker官网安装教程：<a href="https://docs.docker.com/engine/install/centos/" target="_blank" rel="noopener">https://docs.docker.com/engine/install/centos/</a><br>在root用户下依次执行以下操作即可：</p>
<ul>
<li><strong>第一步</strong> 卸载旧的安装包</li>
</ul>
<pre><code>yum remove docker \
 docker-client \
 docker-client-latest \
 docker-common \
 docker-latest \
 docker-latest-logrotate \
 docker-logrotate \
 docker-engine</code></pre><ul>
<li><strong>第二步</strong> 安装需要的安装包</li>
</ul>
<pre><code>yum install -y yum-utils</code></pre><ul>
<li><strong>第三步</strong> 设置镜像仓库</li>
</ul>
<pre><code>yum-config-manager \
 --add-repo \
 https://download.docker.com/linux/centos/docker-ce.repo --默认是国外的

#如果没有vpn 建议安装阿里云的   
yum-config-manager \
 --add-repo \
 http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo

#更新yum 索引安装包
yum makecache fast</code></pre><ul>
<li><strong>第四步</strong> 安装docker相关</li>
</ul>
<pre><code>yum install docker-ce docker-ce-cli containerd.io (可能会出错，多试几次)</code></pre><ul>
<li>*<em>第五步 *</em> 启动docker服务</li>
</ul>
<pre><code>systemctl start docker
#查看docker 是否安装完成
docker --version</code></pre><ul>
<li><strong>第六步</strong> HelloWorld</li>
</ul>
<pre><code>docker run hello-world
#查看所有的docker 镜像
 docker images
docker search aspnet
docker pull mcr.microsoft.com/dotnet/core/aspnet:latest</code></pre><h3 id="Docker-卸载"><a href="#Docker-卸载" class="headerlink" title="Docker 卸载"></a>Docker 卸载</h3><ul>
<li><p>卸载依赖 <code>yum remove docker-ce docker-ce-cli containerd.io</code></p>
</li>
<li><p>删除资源 <code>rm -rf /var/lib/docker</code></p>
</li>
</ul>
<h3 id="Docker镜像先关的基本指令"><a href="#Docker镜像先关的基本指令" class="headerlink" title="Docker镜像先关的基本指令"></a>Docker镜像先关的基本指令</h3><h4 id="查看所有镜像"><a href="#查看所有镜像" class="headerlink" title="查看所有镜像"></a>查看所有镜像</h4><ul>
<li>docker images</li>
</ul>
<p><strong>REPOSITORY</strong>：表示镜像的仓库源</p>
<p><strong>TAG</strong>：镜像的标签</p>
<p><strong>IMAGE ID</strong>：镜像ID</p>
<p><strong>CREATED</strong>：镜像创建时间</p>
<p><strong>SIZE**</strong>：镜像大小</p>
<h4 id="获取新的镜像："><a href="#获取新的镜像：" class="headerlink" title="获取新的镜像："></a>获取新的镜像：</h4><ul>
<li>docker pull 名称</li>
</ul>
<h4 id="查找镜像"><a href="#查找镜像" class="headerlink" title="查找镜像"></a>查找镜像</h4><ul>
<li>docker search httpd</li>
</ul>
<p>*<em>NAME: *</em> 镜像仓库源的名称</p>
<p>*<em>DESCRIPTION: *</em>镜像的描述</p>
<p>*<em>OFFICIAL: *</em>是否 docker 官方发布</p>
<p>*<em>stars: *</em>类似 Github 里面的 star，表示点赞、喜欢的意思。</p>
<p>*<em>AUTOMATED: *</em>自动构建。</p>
<h3 id="删除镜像-会提示先停止使用中的容器"><a href="#删除镜像-会提示先停止使用中的容器" class="headerlink" title="删除镜像(会提示先停止使用中的容器)"></a>删除镜像(会提示先停止使用中的容器)</h3><ul>
<li>docker rmi 镜像name/镜像id</li>
</ul>
<h4 id="创建镜像"><a href="#创建镜像" class="headerlink" title="创建镜像"></a>创建镜像</h4><ul>
<li><p>使用 Dockerfile 指令来创建一个新的镜像</p>
<p><strong>docker build</strong> ，从零开始来创建一个新的镜像。为此，我们需要创建一个 Dockerfile 文件，其中包含一组指令来告诉 Docker 如何构建我们的镜像。</p>
</li>
</ul>
<h4 id="更新镜像"><a href="#更新镜像" class="headerlink" title="更新镜像"></a>更新镜像</h4><ul>
<li><p>运行的容器</p>
</li>
<li><p>docker exec -it fd2c868cadlc /bin/bash 进入容器操作</p>
</li>
<li><p>apt-get update</p>
</li>
<li><p>exit</p>
</li>
<li><p>docker commit 来提交容器副本</p>
</li>
</ul>
<p>docker commit -m=”nginx has update0618” -a=”chaoqiang” 79323dxds323 nginx-8081-8082:vCustom2</p>
<p>· <strong>-m:</strong> 提交的描述信息</p>
<p>· <strong>-a:</strong> 指定镜像作者</p>
<p>· 79323dxds323<strong>：</strong>容器 ID</p>
<p>· nginx-8081-8082:vCustom2<strong>:</strong> 指定要创建的目标镜像名-tag</p>
<p>(要点时间)</p>
<h4 id="设置镜像标签"><a href="#设置镜像标签" class="headerlink" title="设置镜像标签"></a>设置镜像标签</h4><ul>
<li><p>docker tag 命令，为镜像添加一个新的标签。</p>
</li>
<li><p>docker tag 860c279d2fec runoob/centos:dev</p>
</li>
<li><p>docker tag 镜像ID，这里是 860c279d2fec ,用户名称、镜像源名(repository name)和新的标签</p>
</li>
</ul>
<h3 id="Docker容器基本命令"><a href="#Docker容器基本命令" class="headerlink" title="Docker容器基本命令"></a>Docker容器基本命令</h3><p>查看全部命令： docker<br>具体命令详情 docker ps –help<br>启动容器  docker run -it nginx /bin/bas</p>
<ul>
<li><strong>-i</strong>: 交互式操作。</li>
<li><strong>-t</strong>: 终端。</li>
<li><strong>-d</strong> <strong>后台运行</strong></li>
<li><strong>nginx</strong>: nginx镜像。</li>
<li><strong>/bin/bash</strong>：放在镜像名后的是命令，这里我们希望有个交互式 Shell，因此用的是 /bin/bash。(exit 退出终端)</li>
<li>表示载入容器后运行bash ,docker中必须要保持一个进程的运行，要不然整个容器启动后就会马上kill itself</li>
</ul>
<h4 id="容器实例基本操作"><a href="#容器实例基本操作" class="headerlink" title="容器实例基本操作"></a>容器实例基本操作</h4><ul>
<li><p>查看所有容器 docker ps -a</p>
</li>
<li><p>查看容器运行日志 docker logs 容器名称/容器id</p>
</li>
<li><p>停止容器运行 docker stop 容器name/容器id</p>
</li>
<li><p>终止容器后运行 docker start 容器name/容器id</p>
</li>
<li><p>容器重启docker restart 容器name/容器id</p>
</li>
<li><p>删除容器 docker rm -f 容器name/容器id</p>
</li>
</ul>
<h4 id="删除镜像"><a href="#删除镜像" class="headerlink" title="删除镜像"></a>删除镜像</h4><ul>
<li><p>docker rmi -f 镜像id (可以根据 docker images 查询)</p>
</li>
<li><p>docker rmi -f $(docker images) –删除所有镜像</p>
</li>
</ul>
<h4 id="查询docker-的详细信息"><a href="#查询docker-的详细信息" class="headerlink" title="查询docker 的详细信息"></a>查询docker 的详细信息</h4><ul>
<li><p>docker stats dockerid</p>
</li>
<li><p>查看 Docker 的底层信息， <strong>docker inspect</strong> 来查看 Docker 的底层信息</p>
</li>
</ul>
<h4 id="停止一个正在运行的容器"><a href="#停止一个正在运行的容器" class="headerlink" title="停止一个正在运行的容器"></a>停止一个正在运行的容器</h4><ul>
<li><p>docker stop 此方式常常被翻译为优雅的停止容器</p>
</li>
<li><p>docker stop 容器ID或容器名</p>
</li>
</ul>
<p>参数 -t：关闭容器的限时，如果超时未能关闭则用kill强制关闭，默认值10s，这个时间用于容器的自己保存状态</p>
<p>docker stop -t=60 容器ID或容器名</p>
<ul>
<li><p>docker kill</p>
</li>
<li><p>docker kill 容器ID或容器名 :直接关闭容器</p>
</li>
</ul>
<p>由此可见stop和kill的主要区别:stop给与一定的关闭时间交由容器自己保存状态，kill直接关闭容器</p>
<ul>
<li>停用全部运行中的容器:</li>
</ul>
<p><code>docker stop $(docker ps -q)</code></p>
<ul>
<li>删除全部容器：</li>
</ul>
<p><code>docker rm $(docker ps -aq)</code></p>
<ul>
<li>一条命令实现停用并删除容器：</li>
</ul>
<p><code>docker stop $(docker ps -q) &amp; docker rm $(docker ps -aq)</code></p>
<h4 id="容器导入导出"><a href="#容器导入导出" class="headerlink" title="容器导入导出"></a>容器导入导出</h4><p><strong>导出容器</strong></p>
<p>如果要导出本地某个容器，可以使用 <strong>docker export</strong> 命令。</p>
<p><code>docker export 1e560fca3906 &gt; nginx.tar</code></p>
<p><strong>导入容器快照</strong></p>
<p>可以使用 docker import 从容器快照文件中再导入为镜像</p>
<p><code>cat docker/ubuntu.tar | docker import - test/ubuntu:v1</code></p>
<p>也可以通过指定 URL 或者某个目录来导入</p>
<p><code>docker import http://example.com/exampleimage.tgz example/imagerepo</code></p>
<h3 id="Docker-仓库管理"><a href="#Docker-仓库管理" class="headerlink" title="Docker 仓库管理"></a>Docker 仓库管理</h3><h4 id="注册-登录"><a href="#注册-登录" class="headerlink" title="注册-登录"></a>注册-登录</h4><p><a href="https://hub.docker.com/" target="_blank" rel="noopener">https://hub.docker.com</a></p>
<p><strong>SignIn **<br>Account: zhengchaoqiang<br>Password: ****</strong></p>
<h4 id="DockerHub基本操作"><a href="#DockerHub基本操作" class="headerlink" title="DockerHub基本操作"></a>DockerHub基本操作</h4><ul>
<li><p>docker login 登录</p>
</li>
<li><p>docker logout 退出</p>
</li>
<li><p>搜索镜像：docker search nginx</p>
</li>
<li><p>拉取镜像 docker pull nginx</p>
</li>
<li><p>推送镜像 docker push nginx-8081-8082:vCustom2（权限没成功）</p>
</li>
</ul>
<h2 id="Docker上部署-Net-Core应用程序"><a href="#Docker上部署-Net-Core应用程序" class="headerlink" title="Docker上部署.Net Core应用程序"></a>Docker上部署.Net Core应用程序</h2><p>一般使用Docker运行一个Net Core的项目有两种方式：</p>
<ul>
<li>一种是发布后的文件+官方CLR镜像；</li>
<li>另一种是使用dockerfile去构建镜像 –run 较为常用</li>
</ul>
<p><a href="https://www.cnblogs.com/94cool/p/9811839.html" target="_blank" rel="noopener">https://www.cnblogs.com/94cool/p/9811839.html</a><br><a href="https://www.cnblogs.com/zhizihuakai/p/11293802.html" target="_blank" rel="noopener">https://www.cnblogs.com/zhizihuakai/p/11293802.html</a></p>
<h3 id="第一种方法-用官方镜像直接启动"><a href="#第一种方法-用官方镜像直接启动" class="headerlink" title="第一种方法 用官方镜像直接启动"></a>第一种方法 用官方镜像直接启动</h3><ul>
<li>首先获取官方镜像 docker pull mcr.microsoft.com/dotnet/core/aspnet:latest</li>
<li>dotnet publish 发布文件 dotnet publish -c Release </li>
<li>通过ssh终端上传文件到Centos服务器的 /root/website/publish 这个目录下</li>
<li>用官方镜像启动net core 3.1的一个demo，命令如下：</li>
</ul>
<p>docker run -d -p 8081:80 -v /root/website/publish:/app –workdir /app mcr.microsoft.com/dotnet/core/aspnet dotnet /app/Demo.dll<br>解读一下这个命令：<code>docker run [选项] &lt;镜像名称, id&gt; [命令] [参数]</code></p>
<ul>
<li><strong>-d</strong> –detach=false 指定容器运行于前台还是后台，默认为false</li>
<li><strong>-p</strong> –public=[] 设置容器暴露的端口 这里对外暴露8081端口，容器内部的端口是80.</li>
<li><strong>-v</strong> –volume=[] 设置容器挂载的存储卷，也就是挂载到容器的某个目录。</li>
<li><strong>-w</strong> –workdir=”” 设置容器的工作目录</li>
<li><strong>dotnet /app/Demo.dll</strong> 在容器的工作目录里运行dotnet 命令</li>
</ul>
<p>更加丰富的dock run命令可以参考：</p>
<pre class="line-numbers language-shell"><code class="language-shell"># run用于指定镜像创建容器
$ docker run [选项] <镜像名称, id> [命令] [参数]

# 选项
-d, --detach=false 指定容器运行于前台还是后台，默认为false。
-i, --interactive=false 打开标准输入用于控制台交互
-t, --tty=false 分配tty设备用来支持终端登录，默认为false。
-u, --user="" 指定容器的用户
-a, --attach=[] 登录容器，必须是以docker run -d启动的容器。
-w, --workdir="" 设置容器的工作目录
-c, --cpu-shares=0 设置容器CPU权重，在CPU共享场景下使用。
-e, --env=[] 设置环境变量，容器中可使用该环境变量。
-m, --memory="" 设置容器的内存上限
-p, --public=[] 设置容器暴露的端口
-h, --hostname="" 设置容器的主机名
-v, --volume=[] 设置容器挂载的存储卷，也就是挂载到容器的某个目录。
--volumn-from=[] 给容器挂载其他容器上的卷，也就是挂载到容器的某个目录。
--cap-add=[] 添加权限
--cap-drop=[] 删除权限
--cidfile="" 运行容器后在指定文件中写入容器PID值，这是典型的监控系统的用法。
--cpuset="" 设置容器可以使用那些CPU，此参数用来设置容器独占CPU。
--device=[] 添加主机设备给容器，相当于设备直通。
--dns=[] 设置容器的DNS服务器
--dns-search=[] 设置容器的DNS搜索域名，写入到容器的/etc/resolv.conf文件。
--env-file=[] 设置环境变量文件，文件格式为每行一个环境变量。
--expose=[] 设置容器暴露的端口，即修改镜像的暴露端口。
--link=[] 设置容器之间的关联关系，使用其他容器的IP、env等信息。
--lxc-conf=[] 设置容器的配置文件，只有在指定--exe-driver=lxc时使用。
--name="" 设置容器的名称，可通过名字进行容器管理，links特性需要使用名字。
--net="bridge" 容器网络设置
--privileged=false 设置容器是否为特权容器，特权容器拥有所有的capabilities。
--restart="no" 设置让其停止后的重启策略
--rm=false 设置容器停止后自动删除容器，不支持以docker run -d启动的容器。
--sig-proxy=true 设置由代理接收并处理信号，但SIGCHLD、SIGSTOP、SIGKILL不能被代理。

# 命令
-d, --detach Detach模式，默认为守护进程模式，即容器以后台方式运行。
--rm=false 若容器内的进程终止则自动删除容器，禁止和-d选项一起使用。
--sig-proxy=true 将所有信号传递给进程，非TTY模式也一样，但不能传递SIGCHLD、SIGKILL、SIGSTOP信号。

# 运行一个在后台执行的容器，同时使用控制台管理。
$ docker run -i -t -d ubuntu:latest

# 运行一个带命令且在后台不断执行的容器，不直接展示容器内部信息。
$ docker run -d ubuntu:latest ping www.docker.com

# 运行一个在后台不断执行的容器，同时带有命令，程序被终止后还能重启继续跑，可用控制台管理。
$ docker run -d --restart=always ubuntu:latest ping www.docker.com

# 为容器指定一个名字
$ docker run -d --name=ubuntu_server ubuntu:latest

# 容器暴露80端口并指定宿主机81端口与其通信（宿主机端口:容器端口）
$ docker run -d --name=ubuntu -p 81:80 ubuntu:latest

# 指定容器内目录与宿主机目录共享（宿主机目录:容器目录）
$ docker run -d --name=ubuntu_server -v /home/www:/var/www ubuntu:latest

# 设置宿主机与docker的共享目录
$  docker run -d -i -t  -p 80:80 -v /share/swoft:/var/www/swoft --name swoft swoft/swoft /bin/bash<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="第二种方法-Dockerfile制作镜像"><a href="#第二种方法-Dockerfile制作镜像" class="headerlink" title="第二种方法 Dockerfile制作镜像"></a>第二种方法 Dockerfile制作镜像</h3><p>在项目中添加Dockerfile用于制作镜像，默认的Dockerfile内容如下；</p>
<pre class="line-numbers language-shell"><code class="language-shell">FROM mcr.microsoft.com/dotnet/core/aspnet:3.1-buster-slim AS base
WORKDIR /app
EXPOSE 80

FROM mcr.microsoft.com/dotnet/core/sdk:3.1-buster AS build
WORKDIR /src
COPY ["Demo/Demo.csproj", "Demo/"]
RUN dotnet restore "Demo/Demo.csproj"
COPY . .
WORKDIR "/src/Demo"
RUN dotnet build "Demo.csproj" -c Release -o /app/build

FROM build AS publish
RUN dotnet publish "Demo.csproj" -c Release -o /app/publish

FROM base AS final
WORKDIR /app
COPY --from=publish /app/publish .
ENTRYPOINT ["dotnet", "Demo.dll"]
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这里解读一下这个Dockerfile:<br><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://img2018.cnblogs.com/blog/450977/201905/450977-20190512115951746-136143052.png" alt=""></p>
<h4 id="FROM"><a href="#FROM" class="headerlink" title="FROM"></a>FROM</h4><p>FROM：指定基础镜像（FROM是必备的指令，并且必须为第一条指令）<br>格式：</p>
<ul>
<li>FROM image</li>
<li>FROM image:tag</li>
<li>FROM image@digest  </li>
<li>示例：FROM mysql:5.6 \</li>
<li>注：tag或digest是可选的，如果不使用这两个值时，会使用latest版本的基础镜像</li>
</ul>
<h5 id="MAINTAINER"><a href="#MAINTAINER" class="headerlink" title="MAINTAINER"></a>MAINTAINER</h5><p>指明镜像维护着及其联系方式（一般是邮箱地址），例如：<br>``MAINTAINER Chaoqiang Zheng <a href="mailto:925610069@qq.com" target="_blank" rel="noopener">925610069@qq.com</a><code>不过，MAINTAINER并不推荐使用，更推荐使用LABEL来指定镜像作者，例如：</code>LABEL maintainer=”chaoqiang.zheng”`</p>
<h4 id="Run"><a href="#Run" class="headerlink" title="Run"></a>Run</h4><p>RUN: 用来执行命令行命令。其基本格式:</p>
<pre class="line-numbers language-shell"><code class="language-shell">shell 执行
格式：
  RUN <command>

exec 执行
格式：
  RUN ["executable", "param1", "param2"]

示例：
  RUN ["executable", "param1", "param2"]
  RUN apk update
  RUN ["/etc/execfile", "arg1", "arg1"]
注：RUN指令创建的中间镜像会被缓存，并会在下次构建中使用。如果不想使用这些缓存镜像，可以在构建时指定--no-cache参数，如：docker build --no-cache<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>举个例子，我们在使用微软官方ASP.NET Core Runtime镜像时往往会加上以下RUN命令，弥补无法在默认镜像下使用Drawing相关接口的缺憾：</p>
<pre class="line-numbers language-shell"><code class="language-shell">FROM microsoft/dotnet:2.2.1-aspnetcore-runtimeRUN 
apt-get updateRUN 
apt-get install -y libgdiplusRUN 
apt-get install -y libc6-devRUN 
ln -s /usr/lib/libgdiplus.so /lib/x86_64-linux-gnu/libgdiplus.so<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="CMD"><a href="#CMD" class="headerlink" title="CMD"></a>CMD</h4><p>启动容器时执行的Shell命令，<strong>构建容器后调用，也就是在容器启动时才进行调用</strong>，例如：</p>
<pre class="line-numbers language-shell"><code class="language-shell">CMD ["-C", "/start.sh"] 
CMD ["/usr/sbin/sshd", "-D"] 
CMD /usr/sbin/sshd -D

CMD ["executable","param1","param2"] (执行可执行文件，优先)
CMD ["param1","param2"] (设置了ENTRYPOINT，则直接调用ENTRYPOINT添加参数)
CMD command param1 param2 (执行shell内部命令)
示例：
CMD echo "This is a test." | wc -
CMD ["/usr/bin/wc","--help"] 
注：CMD不同于RUN，CMD用于指定在容器启动时所要执行的命令，而RUN用于指定镜像构建时所要执行的命令。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="EXPOSE"><a href="#EXPOSE" class="headerlink" title="EXPOSE"></a>EXPOSE</h4><p>声明容器运行的服务端口，指定与外界交互的端口，例如：</p>
<pre class="line-numbers language-shell"><code class="language-shell">EXPOSE 80  443
EXPOSE 8080
EXPOSE 11211/tcp 11211/udp 
注：EXPOSE并不会让容器的端口访问到主机。要使其可访问，需要在docker run运行容器时通过-p来发布这些端口，或通过-P参数来发布EXPOSE导出的所有端口。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="ENV"><a href="#ENV" class="headerlink" title="ENV"></a>ENV</h4><p>设置系统内环境变量，例如：</p>
<pre class="line-numbers language-shell"><code class="language-shell">ENV MYSQL_ROOT_PASSWORD 123456
ENV JAVA_HOME /usr/local/jdk1.8.0_45

ENV <key> <value> #<key>
之后的所有内容均会被视为其<value>的组成部分，因此，一次只能设置一个变量
ENV <key>=<value> ... 
可以设置多个变量，每个变量为一个"<key>=<value>"的键值对，如果<key>中包含空格，可以使用\来进行转义，也可以通过""来进行标示；另外，反斜线也可以用于续行

示例：
ENV myName John Doe
ENV myDog Rex The Dog
ENV myCat=fluffy<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="ADD"><a href="#ADD" class="headerlink" title="ADD"></a>ADD</h4><p>拷贝文件或目录到镜像中，如果是URL或压缩包，会自动下载或自动解压。<br><strong>将本地文件添加到容器中，tar类型文件会自动解压(网络压缩资源不会被解压)，可以访问网络资源，类似wget</strong></p>
<pre class="line-numbers language-shell"><code class="language-shell">格式：
ADD <src>... <dest>
ADD ["<src>",... "<dest>"] 用于支持包含空格的路径

示例：
ADD hom* /mydir/ # 添加所有以"hom"开头的文件
ADD hom?.txt /mydir/ # ? 替代一个单字符,例如："home.txt"
ADD test relativeDir/ # 添加  "test"  到 `WORKDIR`/relativeDir/
ADD test /absoluteDir/ # 添加  "test"  到 /absoluteDir/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="COPY"><a href="#COPY" class="headerlink" title="COPY"></a>COPY</h4><p>拷贝文件或目录到镜像中，用法同ADD，只是不支持自动下载和解压:<br><code>COPY ./start.sh /start.sh</code></p>
<h4 id="ENTRYPOINT"><a href="#ENTRYPOINT" class="headerlink" title="ENTRYPOINT"></a>ENTRYPOINT</h4><p>启动容器时执行的Shell命令，同CMD类似，只是由ENTRYPOINT启动的程序<strong>不会被docker run命令行指定的参数所覆盖</strong>，而且，<strong>这些命令行参数会被当作参数传递给ENTRYPOINT指定指定的程序</strong>，例如：</p>
<pre class="line-numbers language-shell"><code class="language-shell">ENTRYPOINT ["/bin/bash", "-C", "/start.sh"]
ENTRYPOINT /bin/bash -C '/start.sh'<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h4 id="VOLUME"><a href="#VOLUME" class="headerlink" title="VOLUME"></a>VOLUME</h4><p>指定容器挂载点到宿主机自动生成的目录或其他容器，一般不会在Dockerfile中用到，更常见的还是在docker run的时候指定-v数据卷。<br><code>VOLUME ["/var/lib/mysql"]</code></p>
<h4 id="USER"><a href="#USER" class="headerlink" title="USER"></a>USER</h4><p>指定运行容器时的用户名或UID，后续的RUN也会使用指定用户。使用USER指定用户时，可以使用用户名、UID或GID，或是两者的组合。当服务不需要管理员权限时，可以通过该命令指定运行用户。并且可以在之前创建所需要的用户。</p>
<pre class="line-numbers language-shell"><code class="language-shell">格式:  　　
USER user  　　
USER user:group  　　
USER uid  　　
USER uid:gid  　　
USER user:gid  　　
USER uid:group

示例：  　　
USER www
注：使用USER指定用户后，Dockerfile中其后的命令RUN、CMD、ENTRYPOINT都将使用该用户。镜像构建完成后，通过docker run运行容器时，可以通过-u参数来覆盖所指定的用户。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="WORKDIR"><a href="#WORKDIR" class="headerlink" title="WORKDIR"></a>WORKDIR</h4><p>为RUN、CMD、ENTRYPOINT以及COPY和AND设置工作目录，例如：<code>WORKDIR /data</code></p>
<pre class="line-numbers language-shell"><code class="language-shell">示例：
WORKDIR /a (这时工作目录为/a)
WORKDIR b (这时工作目录为/a/b)
WORKDIR c (这时工作目录为/a/b/c)  
注：通过WORKDIR设置工作目录后，Dockerfile中其后的命令RUN、CMD、ENTRYPOINT、ADD、COPY等命令都会在该目录下执行。在使用docker run运行容器时，可以通过-w参数覆盖构建时所设置的工作目录。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="ARG"><a href="#ARG" class="headerlink" title="ARG"></a>ARG</h4><p>在构建镜像时，指定一些参数，例如：</p>
<pre class="line-numbers language-shell"><code class="language-shell">FROM centos:6 ARG user # ARG user=root
USER $user<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>这时，我们在docker build时可以带上自定义参数user了，如下所示：<br><code>docker build --build-arg user=chaoqiang Dockerfile .</code></p>
<h4 id="HEALTHCHECK"><a href="#HEALTHCHECK" class="headerlink" title="HEALTHCHECK"></a>HEALTHCHECK</h4><p>告诉Docker如何测试容器以检查它是否仍在工作，即健康检查，例如：</p>
<pre class="line-numbers language-shell"><code class="language-shell">HEALTHCHECK --interval=5m --timeout=3s --retries=3 \
    CMD curl -f http:/localhost/ || exit 1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>其中，一些选项的说明：</p>
<ul>
<li>–interval=DURATION (default: 30s)：每隔多长时间探测一次，默认30秒</li>
<li>– timeout= DURATION (default: 30s)：服务响应超时时长，默认30秒</li>
<li>–start-period= DURATION (default: 0s)：服务启动多久后开始探测，默认0秒</li>
<li>–retries=N (default: 3)：认为检测失败几次为宕机，默认3次</li>
</ul>
<p>一些返回值的说明：</p>
<ul>
<li>0：容器成功是健康的，随时可以使用</li>
<li>1：不健康的容器无法正常工作</li>
<li>2：保留不使用此退出代码</li>
</ul>
<h3 id="精简制作"><a href="#精简制作" class="headerlink" title="精简制作"></a>精简制作</h3><p>目的是将发布好的net core发布包直接制作镜像，不希望在linux上去执行restore build命令，因为有时候一些Nuget包是私有仓库的，无法获取，再一个是因为项目工程直接拷贝到服务器上也比较麻烦，因为我们最终开发调试还是在VS和windows环境下，所以这里精简的要求就是：Dockerfile中只执行拷贝和启动命令，不需要restore和build和publish这些命令；</p>
<p>初步的Dockerfile如下：</p>
<pre class="line-numbers language-shell"><code class="language-shell">FROM mcr.microsoft.com/dotnet/core/aspnet:3.1-buster-slim AS base
WORKDIR /app
EXPOSE 8082

COPY . /app
ENTRYPOINT ["dotnet", "Demo.dll"]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>然后在这个目录下执行制作镜像的命令：<br><code>docker build -t chaoqiang.docker.demo .</code><br>注意结尾这个点千万不能丢。</p>
<p>接下来就是通过制作好的镜像来运行容器<br><code>docker run -d -p 8010:8082 --name dockerdemo chaoqiang.docker.demo</code></p>
<p>通过验证发现一个问题，容器运行时没有将8082端口成功映射出来，我们进入终端看一下启动的详细日志：<br>docker run -it -p 8106:8082 –name dockerdemo chaoqiang.docker.demo<br>发现net core启动使用了默认端口80端口，没有按照我们想要的使用8082端口，这是为什么？</p>
<p>ASP.NET Core项目使用Kestrel作为默认的web服务器。<br>而集成Kestrel的ASP.NET Core有<a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/servers/kestrel?tabs=aspnetcore2x&amp;view=aspnetcore-3.1#endpoint-configuration" target="_blank" rel="noopener">4中方式</a>指定终结点URL：</p>
<ul>
<li><code>ASPNETCORE_URLS</code> 环境变量</li>
<li><code>--urls</code>命令行参数</li>
<li><code>urls</code> 主机配置键</li>
<li><code>UseUrls</code>扩展方法</li>
</ul>
<p>这是因为基础镜像<code>.NET Core Runtime Dependencies</code>构建镜像的Dockerfile中指定了应用终结点URL</p>
<pre class="line-numbers language-shell"><code class="language-shell">ENV ASPNETCORE_URLS=http://+:80<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>所以你想修改默认端口,在你的Dockerfile添加如下，修改默认值即可：</p>
<pre class="line-numbers language-shell"><code class="language-shell">ENV ASPNETCORE_URLS=http://+:8082<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>这里我们通过指定–Urls来实现也是可以的，传入参数即可，最终Dockerfile如下：</p>
<pre class="line-numbers language-shell"><code class="language-shell">FROM mcr.microsoft.com/dotnet/core/aspnet:3.1-buster-slim AS base
WORKDIR /app
EXPOSE 8082

COPY . /app
ENTRYPOINT ["dotnet", "Demo.dll","--urls=http://*:8082"]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://www.zhengchaoqiang.com" rel="external nofollow noreferrer">Chaoqiang</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://www.zhengchaoqiang.com/2020/06/24/docker-crash-tutorial/">https://www.zhengchaoqiang.com/2020/06/24/docker-crash-tutorial/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="https://www.zhengchaoqiang.com" target="_blank">Chaoqiang</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/Docker/">
                                    <span class="chip bg-color">Docker</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">

<div id="article-share">
    
    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你要请我吃糖嘛!</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechatpay.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>
            
        </div>
    </div>

    

    

    

    

    
        <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }

    #vcomments textarea {
        box-sizing: border-box;
        background: url("/medias/comment_bg.png") 100% 100% no-repeat;
    }

    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #4cbf30;
        font-weight: 500;
        text-decoration: none;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="vcomments" class="card-content" style="display: grid">
    </div>
</div>

<script src="/libs/valine/av-min.js"></script>
<script src="/libs/valine/Valine.min.js"></script>
<script>
    new Valine({
        el: '#vcomments',
        appId: 'n7QWLgVufdyFqbDlUDEznVhx-gzGzoHsz',
        appKey: 'YGPdAIijkOPzqgi0LlHI52ex',
        notify: 'true' === 'true',
        verify: 'true' === 'true',
        visitor: 'true' === 'true',
        avatar: 'mm',
        pageSize: '10',
        lang: 'zh-cn',
        placeholder: 'just go go'
    });
</script>

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2020/12/29/2021-annual-review-and-planning/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/10.jpg" class="responsive-img" alt="2021-Annual-Review-and-Planning">
                        
                        <span class="card-title">2021-Annual-Review-and-Planning</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            2020年回顾时光飞逝，2020年距离结束还剩下不到60个小时，此刻公司的大楼外，雪花飞舞，在这朦胧的夜色中倒显得有点活泼，想来，这也是苏州2020年的第一场雪。透过14楼的落地玻璃，远眺，没有丝毫寒意，却将半个工业园区尽收眼底。此情此景，
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2020-12-29
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Diary/" class="post-category">
                                    Diary
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Yearly-Planning/">
                        <span class="chip bg-color">Yearly Planning</span>
                    </a>
                    
                    <a href="/tags/Yearly-Review/">
                        <span class="chip bg-color">Yearly Review</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2020/06/06/netcore-authentication-authorization3/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/3.jpg" class="responsive-img" alt="Netcore认证授权与IdentityServer4（3）IdentityServer4详解">
                        
                        <span class="card-title">Netcore认证授权与IdentityServer4（3）IdentityServer4详解</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            主要内容
OAuth2.0&amp;Token
IdentityServer4-四模式实现
授权策略和扩展
OIDC-Hybrid

OAuth 2.0什么是OAuth 2.0?

授权机制，是一种规范/委托协议，制定了授权流程；它可以让那
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2020-06-06
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Net-Core-Learning-Series/" class="post-category">
                                    .Net Core Learning Series
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Net-Core/">
                        <span class="chip bg-color">Net Core</span>
                    </a>
                    
                    <a href="/tags/IdentityServer4/">
                        <span class="chip bg-color">IdentityServer4</span>
                    </a>
                    
                    <a href="/tags/OAuth-2-0/">
                        <span class="chip bg-color">OAuth 2.0</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('120')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + '来源: chaoqiang&#39;s Blog<br />'
            + '文章作者: chaoqiang<br />'
            + '文章链接: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者所有，任何形式的转载都请注明出处。';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>


<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


<!-- 代码块折行 -->

<style type="text/css">
code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }
</style>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>



    <footer class="page-footer bg-color">
    <div class="container row center-align">
        <div class="col s12 m8 l8 copy-right">
            <span>
                <div>
                    <span style="color:#ffffff;">Copyright&copy; 2020 chaoqiang. All Rights Reserved</span>
                </div>
                
                <div style="width:500px;margin:0 auto; padding:0px 0;">
                    <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=32050702010849" style="display:inline-block;text-decoration:none;height:20px;line-height:20px;">
                        <img src="https://blog-icp-1257411902.cos.ap-shanghai.myqcloud.com/icp.png" style="float:left;"/>
                        <span style="float:left;height:20px;line-height:20px;margin: 0px 0px 0px 5px; color:#ffffff;">苏公网安备 32050702010849号 苏ICP备20017637号</span>
                    </a>
                    <!-- <span style="height:20px;line-height:20px;margin: 0px 0px 0px 5px; color:#ffffff;"> 苏ICP备20017637号</span> -->
                </div>
            </span>
            <span id="sitetime"></span>
        </div>

    
    </div>
</footer>

<div class="progress-bar"></div>

<script language=javascript>
    function siteTime() {
        window.setTimeout("siteTime()", 1000);
        var seconds = 1000;
        var minutes = seconds * 60;
        var hours = minutes * 60;
        var days = hours * 24;
        var years = days * 365;
        var today = new Date();
        var todayYear = today.getFullYear();
        var todayMonth = today.getMonth() + 1;
        var todayDate = today.getDate();
        var todayHour = today.getHours();
        var todayMinute = today.getMinutes();
        var todaySecond = today.getSeconds();

        /* Date.UTC() -- 返回date对象距世界标准时间(UTC)1970年1月1日午夜之间的毫秒数(时间戳)
        year - 作为date对象的年份，为4位年份值
        month - 0-11之间的整数，做为date对象的月份
        day - 1-31之间的整数，做为date对象的天数
        hours - 0(午夜24点)-23之间的整数，做为date对象的小时数
        minutes - 0-59之间的整数，做为date对象的分钟数
        seconds - 0-59之间的整数，做为date对象的秒数
        microseconds - 0-999之间的整数，做为date对象的毫秒数 */

        var t1 = Date.UTC(2019, 08, 10, 00, 00, 00); //北京时间2019-8-1 00:00:00
        var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
        var diff = t2 - t1;
        var diffYears = Math.floor(diff / years);
        var diffDays = Math.floor((diff / days) - diffYears * 365);
        var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
        var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) / minutes);
        var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours - diffMinutes *
            minutes) / seconds);
        document.getElementById("sitetime").innerHTML = "本站已勉强运行 " + diffYears + " 年 " + diffDays + " 天 " + diffHours +
            " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒" ;
    } /*因为建站时间还没有一年，就将之注释掉了。需要的可以取消*/
    siteTime();
</script>






    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("/" + "search.xml", 'searchInput', 'searchResult');
});
</script>
    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Global site tag (gtag.js) - Google Analytics -->


    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    
    <script type="text/javascript" color="0,0,255"
        pointColor="0,0,255" opacity='0.7'
        zIndex="-1" count="99"
        src="/libs/background/canvas-nest.js"></script>
    

    

    
    
    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

     <!-- Chaoqiang shw2018 add 2019.08.28 -->
     <script type="text/javascript">
        var OriginTitile = document.title,
            st;
        document.addEventListener("visibilitychange", function () {
            document.hidden ? (document.title = "看不见我🙈~看不见我🙈~", clearTimeout(st)) : (document.title =
                "(๑•̀ㅂ•́) ✧被发现了～", st = setTimeout(function () {
                    document.title = OriginTitile
                }, 3e3))
        })
    </script>

    <!-- 鼠标点击烟花爆炸效果  Chaoqiang shw2018 add 2019.09.09 -->
    
        <canvas class="fireworks" style="position: fixed; left: 0; top: 0; z-index: 1; pointer-events: none;"></canvas>
        <script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script>
        <script type="text/javascript" src="/js/fireworks.js"></script>
    

    <!-- 背景雪花飘落特效Chaoqiang shw2018 add 2019.09.10 -->
    

    <!-- 鼠标点击文字特效 Chaoqiang shw2018 add 2019.09.10-->
    
        <script src="/js/wenzi.js" type="text/javascript"></script>
    

    <!-- 背景雪花飘落特效 Chaoqiang shw2018 add 2019.09.10 -->
    

    <!-- 在线聊天工具  Chaoqiang shw2018 add 2019.09.11 -->
    

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"left","width":150,"height":200},"mobile":{"show":false},"react":{"opacity":0.7}});</script><script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 1,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(n){n.imageLazyLoadSetting.processImages=o;var e=n.imageLazyLoadSetting.isSPA,i=n.imageLazyLoadSetting.preloadRatio||1,r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function o(){e&&(r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));for(var t,a=0;a<r.length;a++)0<=(t=(t=r[a]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(n.innerHeight*i||document.documentElement.clientHeight*i)&&function(){var t,e,n,i,o=r[a];t=o,e=function(){r=r.filter(function(t){return o!==t})},n=new Image,i=t.getAttribute("data-original"),n.onload=function(){t.src=i,e&&e()},t.src!==i&&(n.src=i)}()}o(),n.addEventListener("scroll",function(){var t,e;t=o,e=n,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(e)},500)})}(this);</script></body>

</html>
